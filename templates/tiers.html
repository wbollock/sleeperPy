<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{if .Username}}{{.Username}}'s Tiers - SleeperPy{{else}}SleeperPy Tiers{{end}}</title>
    <meta name="description" content="Fantasy football tier analysis and lineup recommendations for Sleeper leagues. Expert consensus rankings by Boris Chen.">
    <meta name="robots" content="noindex">

    <!-- Open Graph -->
    <meta property="og:title" content="SleeperPy - Fantasy Football Tier Analysis">
    <meta property="og:description" content="Tier-based lineup recommendations for your Sleeper fantasy football leagues.">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="SleeperPy">

    <meta name="theme-color" content="#1e293b">
    <link rel="manifest" href="/static/manifest.json">

    <link rel="stylesheet" href="/static/main.css?v=20260211d">
    <link rel="stylesheet" href="/static/dynasty.css?v=20260211d">
    <link rel="stylesheet" href="/static/theme.css?v=20260211d">
    <link rel="stylesheet" href="/static/cookie-consent.css?v=20260211d">
    <link rel="stylesheet" href="/static/loading.css?v=20260211d">
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <style>
        .skip-link {
            position: absolute;
            top: -100%;
            left: 16px;
            background: #0ea5e9;
            color: #fff;
            padding: 8px 16px;
            border-radius: 0 0 8px 8px;
            z-index: 1000;
            font-weight: 600;
            text-decoration: none;
        }
        .skip-link:focus {
            top: 0;
        }
    </style>
</head>
<body>
<a href="#main-content" class="skip-link">Skip to main content</a>
<header class="app-header" role="banner">
    <div class="header-content">
        <div class="logo-section">
            <a href="/" style="display:flex; align-items:center; gap:12px; text-decoration:none;">
                <svg class="logo-icon" width="32" height="32" viewBox="0 0 32 32" fill="none">
                    <rect width="32" height="32" rx="8" fill="#0ea5e9"/>
                    <path d="M16 8L22 12V20L16 24L10 20V12L16 8Z" fill="white"/>
                    <circle cx="16" cy="16" r="3" fill="#0ea5e9"/>
                </svg>
                <h1 style="color:#f1f5f9; margin:0;">SleeperPy</h1>
            </a>
        </div>
        <div style="display: flex; align-items: center; gap: 16px;">
            <div class="theme-toggle">
                <button class="theme-option active" data-theme="" onclick="switchTheme('')" title="Default">üåô</button>
                <button class="theme-option" data-theme="dark" onclick="switchTheme('dark')" title="Dark">üåë</button>
                <button class="theme-option" data-theme="light" onclick="switchTheme('light')" title="Light">‚òÄÔ∏è</button>
            </div>
            <button type="button" class="cache-reset-btn" onclick="clearAppCache()">Clear Cache</button>
            {{if .Username}}
            <div class="user-info">
                <span class="username-display">{{.Username}}</span>
                <a href="/signout" class="signout-btn">Sign Out</a>
            </div>
            {{end}}
        </div>
    </div>
</header>
<main id="main-content" class="main-content" role="main">
{{if .Error}}
<div style="max-width:600px; margin:3em auto; padding:2em; background:rgba(239,68,68,0.08); border:1px solid rgba(239,68,68,0.25); border-radius:12px; text-align:center;">
    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" style="margin-bottom:12px;">
        <circle cx="12" cy="12" r="10" stroke="#ef4444" stroke-width="2"/>
        <path d="M12 8v4M12 16h.01" stroke="#ef4444" stroke-width="2" stroke-linecap="round"/>
    </svg>
    <p style="color:#fca5a5; font-size:1.1em; margin:0 0 1em 0; line-height:1.5;">{{.Error}}</p>
    <a href="/" style="display:inline-block; padding:10px 24px; background:#0ea5e9; color:#fff; border-radius:8px; text-decoration:none; font-weight:600; transition:background 0.2s;">Try Again</a>
</div>
{{else}}
{{with .Leagues}}
    {{/* Shareable link box removed as the URL is self-evident */}}
{{end}}

<script src="/static/tiers.js"></script>

{{$leagueCount := len .Leagues}}
<div class="league-selector-container">
    <div class="league-selector">
        <button class="league-dropdown-btn" onclick="toggleLeagueDropdown()">
            <span class="current-league-name" id="currentLeagueName">{{(index .Leagues 0).LeagueName}}</span>
            <span class="league-count">({{$leagueCount}} leagues)</span>
            <span class="dropdown-arrow">‚ñº</span>
        </button>
        <div class="league-dropdown-menu" id="leagueDropdown" style="display:none;">
            <input type="text" class="league-search" id="leagueSearch" placeholder="Search leagues..." onkeyup="filterLeagues()">
            <div class="league-options" id="leagueOptions">
                {{/* Favorites group */}}
                <div class="league-group" id="favorites-group" style="display:none;">
                    <div class="league-group-header">‚≠ê Favorites</div>
                </div>

                {{/* Group dynasty leagues */}}
                <div class="league-group" id="dynasty-group">
                    <div class="league-group-header">üèÜ Dynasty Leagues</div>
                    {{range $i, $l := .Leagues}}
                        {{if $l.IsDynasty}}
                        <button class="league-option {{if eq $i 0}}active{{end}}" data-league-id="league{{$i}}" data-league-name="{{$l.LeagueName}}" onclick="selectLeague(event, 'league{{$i}}', '{{$l.LeagueName}}')">
                            <span class="league-option-name">{{$l.LeagueName}}</span>
                            <span class="league-option-meta">{{$l.LeagueSize}} teams ¬∑ {{$l.Scoring}}</span>
                            <span class="league-option-actions">
                                <span class="league-option-type">({{$l.Scoring}})</span>
                                <span class="favorite-star" onclick="toggleFavorite(event, 'league{{$i}}', '{{$l.LeagueName}}')" title="Add to favorites">‚òÜ</span>
                            </span>
                        </button>
                        {{end}}
                    {{end}}
                </div>

                {{/* Group redraft leagues */}}
                <div class="league-group" id="redraft-group">
                    <div class="league-group-header">üìä Redraft Leagues</div>
                    {{range $i, $l := .Leagues}}
                        {{if not $l.IsDynasty}}
                        <button class="league-option {{if eq $i 0}}active{{end}}" data-league-id="league{{$i}}" data-league-name="{{$l.LeagueName}}" onclick="selectLeague(event, 'league{{$i}}', '{{$l.LeagueName}}')">
                            <span class="league-option-name">{{$l.LeagueName}}</span>
                            <span class="league-option-meta">{{$l.LeagueSize}} teams ¬∑ {{$l.Scoring}}</span>
                            <span class="league-option-actions">
                                <span class="league-option-type">({{$l.Scoring}})</span>
                                <span class="favorite-star" onclick="toggleFavorite(event, 'league{{$i}}', '{{$l.LeagueName}}')" title="Add to favorites">‚òÜ</span>
                            </span>
                        </button>
                        {{end}}
                    {{end}}
                </div>
            </div>
        </div>
    </div>
</div>
{{if .IsPremium}}
<div class="premium-controls">
    {{if .PremiumEnabled}}
    <form method="get" action="/lookup" class="premium-actions">
        <input type="hidden" name="username" value="{{.Username}}">
        <button class="premium-btn" type="submit" name="llm" value="overview">All Teams Overview</button>
        <button class="premium-btn" type="submit" name="llm" value="team">Generate Team Talks</button>
        <button class="premium-btn" type="submit" name="llm" value="all">Overview + Team Talks</button>
    </form>
    {{else}}
    <div class="premium-disabled">Premium AI is enabled for your username, but `OPENROUTER_API_KEY` is not set on the server.</div>
    {{end}}
</div>
{{end}}
{{if .PremiumOverview}}
<div class="premium-overview-card">
    <div class="premium-overview-title">All Teams Overview</div>
    <div class="premium-overview-text">{{.PremiumOverview}}</div>
</div>
{{end}}
<div class="league-contents">
    {{range $i, $l := .Leagues}}
        <div class="league-content" id="league{{$i}}" style="display:{{if eq $i 0}}block{{else}}none{{end}};">
            <div class="league-info-bar">
                <div class="league-meta">
                    <span>{{$l.LeagueSize}}-team</span>
                    <span>{{$l.Scoring}}</span>
                    {{if $l.IsDynasty}}<span class="dynasty-badge">Dynasty</span>{{end}}
                    {{if $l.RosterSlots}}<span class="league-info-slots">{{$l.RosterSlots}}</span>{{end}}
                </div>
                <div class="player-search-container">
                    <input type="text" class="player-search" id="playerSearch{{$i}}" placeholder="Search players..." onkeyup="searchPlayers({{$i}})">
                </div>
            </div>
            {{if $l.IsDynasty}}
            <div class="mode-toggle-container">
                <div class="mode-toggle">
                    <button class="mode-btn" onclick="switchMode(event, {{$i}}, 'inseason')">In-Season</button>
                    <button class="mode-btn active" onclick="switchMode(event, {{$i}}, 'dynasty')">Dynasty</button>
                </div>
                <div class="mode-description">
                    <span class="inseason-desc" style="display:none;">Weekly matchups & tier-based recommendations</span>
                    <span class="dynasty-desc">Long-term value & dynasty toolkit</span>
                </div>
            </div>
            {{end}}

            <div class="league-grid-container{{if not $l.IsDynasty}} single-column{{end}}">
                <div class="roster-card">
            <div class="table-scroll">
            <table class="sortable-table pretty-table">
                <thead>
                    <tr>
                        <th>Position</th>
                        <th>Player</th>
                        {{if $l.IsDynasty}}
                        <th class="inseason-only" style="display:none;">Tier</th>
                        <th class="dynasty-only">Age</th>
                        <th>Dynasty Value</th>
                        {{else}}
                        <th>Tier</th>
                        {{end}}
                    </tr>
                </thead>
                <tbody>
                {{range $l.Starters}}
                    <tr{{if eq .Tier 1}} class="tier1"{{else if .IsTierWorseThanBench}} class="tier-worse"{{end}}>
                        <td>{{.Pos}}</td>
                        <td>{{if eq .Tier 1}}<span class="tier1-star">‚òÖ</span> {{end}}{{.Name | safe}}</td>
                        {{if $l.IsDynasty}}
                        <td class="inseason-only" style="display:none;">{{.Tier}}{{if .IsFlex}} <span style="background:#7bb0ff;color:#1a1f2e;padding:2px 5px;border-radius:3px;font-size:0.85em;font-weight:bold;">FLEX</span>{{else if .IsSuperflex}} <span style="background:#7bb0ff;color:#1a1f2e;padding:2px 5px;border-radius:3px;font-size:0.85em;font-weight:bold;">SF</span>{{end}}</td>
                        <td class="dynasty-only">{{if .Age}}{{.Age}}{{else}}-{{end}}</td>
                        <td>{{if .DynastyValue}}{{.DynastyValue}}{{else}}-{{end}}</td>
                        {{else}}
                        <td>{{.Tier}}{{if .IsFlex}} <span style="background:#7bb0ff;color:#1a1f2e;padding:2px 5px;border-radius:3px;font-size:0.85em;font-weight:bold;">FLEX</span>{{else if .IsSuperflex}} <span style="background:#7bb0ff;color:#1a1f2e;padding:2px 5px;border-radius:3px;font-size:0.85em;font-weight:bold;">SF</span>{{end}}</td>
                        {{end}}
                    </tr>
                {{end}}
                {{range $l.Unranked}}
                    <tr>
                        <td>
                            {{if eq .Pos "FLEX"}}<span style="color:#7bb0ff;font-weight:bold;">FLEX</span>{{else if eq .Pos "SUPERFLEX"}}<span style="color:#7bb0ff;font-weight:bold;">SUPERFLEX</span>{{else}}{{.Pos}}{{end}}
                        </td>
                        <td>{{.Name | safe}}</td>
                        {{if $l.IsDynasty}}
                        <td class="inseason-only" style="display:none;">{{.Tier}}</td>
                        <td class="dynasty-only">{{if .Age}}{{.Age}}{{else}}-{{end}}</td>
                        <td>-</td>
                        {{else}}
                        <td>{{.Tier}}</td>
                        {{end}}
                    </tr>
                {{end}}
                </tbody>
                <tfoot>
                    <tr class="{{if $l.IsDynasty}}inseason-only{{end}}"><td colspan="{{if $l.IsDynasty}}4{{else}}3{{end}}" class="summary" style="padding:16px;"><b>Average Tier: {{$l.AvgTier}}</b></td></tr>
                    {{if $l.HasMatchups}}
                    <tr class="{{if $l.IsDynasty}}inseason-only{{end}}"><td colspan="{{if $l.IsDynasty}}4{{else}}3{{end}}" class="summary" style="padding:16px;"><b>Opponent Average Tier: {{$l.AvgOppTier}}</b></td></tr>
                    <tr class="{{if $l.IsDynasty}}inseason-only{{end}}">
                        <td colspan="{{if $l.IsDynasty}}4{{else}}3{{end}}" style="padding:12px 0; background:transparent; border:none; text-align:center;">
                            <div class="winprob-row">
                                <span class="winprob-label">Win Probability</span>
                                <span class="winprob-bar-wrap">
                                    <span class="winprob-bar-bg">
                                        <span class="winprob-bar" style="width: {{parseWinProb $l.WinProb}}%; background: {{winProbColor $l.WinProb}};"></span>
                                    </span>
                                </span>
                                <span class="winprob-badge" style="background: {{winProbColor $l.WinProb}};">
                                    {{parseWinProb $l.WinProb}}%
                                </span>
                                <span class="winprob-emoji">{{parseWinEmoji $l.WinProb}}</span>
                            </div>
                        </td>
                    </tr>
                    {{else}}
                    <tr class="{{if $l.IsDynasty}}inseason-only{{end}}"><td colspan="{{if $l.IsDynasty}}4{{else}}3{{end}}" class="summary" style="padding:16px;font-style:italic;color:#9fb3d4;">Offseason - No active matchups</td></tr>
                    {{end}}
                    {{if $l.IsDynasty}}
                    <tr class="dynasty-only">
                        <td colspan="4" class="summary" style="padding:16px;">
                            <b>Total Roster Value: {{$l.TotalRosterValue}}</b><br>
                            <b style="margin-top:8px;display:block;">Your Team's Average Age: {{printf "%.1f" $l.UserAvgAge}} years</b>
                        </td>
                    </tr>
                    {{end}}
                    <tr><th colspan="{{if $l.IsDynasty}}4{{else}}3{{end}}" class="bench-header" style="padding-top:24px; padding-bottom:16px;">Bench</th></tr>
                    {{range $l.Bench}}
                        <tr{{if eq .Tier 1}} class="tier1"{{else if .ShouldSwapIn}} class="swap-candidate"{{end}}>
                            <td>{{.Pos}}</td>
                            <td>{{if eq .Tier 1}}<span class="tier1-star">‚òÖ</span> {{end}}{{if .ShouldSwapIn}}<span class="swap-icon">‚áÑ</span> {{end}}{{.Name | safe}}</td>
                            {{if $l.IsDynasty}}
                            <td class="inseason-only" style="display:none;">{{.Tier}}{{if .IsFlex}} <span style="background:#7bb0ff;color:#1a1f2e;padding:2px 5px;border-radius:3px;font-size:0.85em;font-weight:bold;">FLEX</span>{{end}}</td>
                            <td class="dynasty-only">{{if .Age}}{{.Age}}{{else}}-{{end}}</td>
                            <td>{{if .DynastyValue}}{{.DynastyValue}}{{else}}-{{end}}</td>
                            {{else}}
                            <td>{{.Tier}}{{if .IsFlex}} <span style="background:#7bb0ff;color:#1a1f2e;padding:2px 5px;border-radius:3px;font-size:0.85em;font-weight:bold;">FLEX</span>{{end}}</td>
                            {{end}}
                        </tr>
                    {{end}}
                    {{range $l.BenchUnranked}}
                        <tr>
                            <td>{{.Pos}}</td>
                            <td>{{.Name | safe}}</td>
                            {{if $l.IsDynasty}}
                            <td class="inseason-only">{{.Tier}}</td>
                            <td class="dynasty-only" style="display:none;">{{if .Age}}{{.Age}}{{else}}-{{end}}</td>
                            <td>-</td>
                            {{else}}
                            <td>{{.Tier}}</td>
                            {{end}}
                        </tr>
                    {{end}}
                    <tr><td colspan="{{if $l.IsDynasty}}4{{else}}3{{end}}" style="padding-top:8px;font-size:0.9em;color:#9fb3d4;font-style:italic;">Note: RB/WR/TE bench players ranked using FLEX tiers</td></tr>
                </tfoot>
            </table>
            </div>

                </div>
                {{if $l.IsDynasty}}
                <div class="dynasty-toolkit dynasty-only">
                    {{if $l.PremiumTeamTalk}}
                    <div class="toolkit-card premium-card">
                        <div class="card-header">
                            <span class="card-title">Team Talk (Premium)</span>
                        </div>
                        <div class="card-content">
                            <div class="premium-text">{{$l.PremiumTeamTalk}}</div>
                        </div>
                    </div>
                    {{end}}
                    {{if $l.DynastyValueDate}}
                    <div class="dynasty-source-info">Dynasty values from <a href="https://github.com/dynastyprocess/data" target="_blank" rel="noopener">DynastyProcess</a> ¬∑ Updated {{$l.DynastyValueDate}}</div>
                    {{end}}
                    {{if $l.PlayerNewsFeed}}
                    <div class="toolkit-card collapseable">
                        <div class="card-header" onclick="toggleSection('player-news-{{$i}}')">
                            <span class="card-title">
                                Player News
                                <span class="news-count">{{len $l.PlayerNewsFeed}}</span>
                            </span>
                            <span class="collapse-icon" id="player-news-{{$i}}-icon">‚ñº</span>
                        </div>
                        <div class="card-content" id="player-news-{{$i}}-content">
                            <div class="news-feed">
                                {{range $l.PlayerNewsFeed}}
                                <div class="news-item{{if .InjuryStatus}} news-injury{{end}}">
                                    <div class="news-header">
                                        <span class="news-player">
                                            {{.PlayerName}} ({{.Position}})
                                            {{if .IsStarter}}<span class="starter-badge">‚≠ê</span>{{end}}
                                        </span>
                                        <span class="news-time">{{formatTime .Timestamp}}</span>
                                    </div>
                                    {{if .InjuryStatus}}
                                    <div class="news-injury-status">{{.InjuryStatus}}</div>
                                    {{end}}
                                    {{if .NewsText}}
                                    <div class="news-text">{{.NewsText}}</div>
                                    {{else if .InjuryBodyPart}}
                                    <div class="news-text">{{.InjuryBodyPart}}{{if .InjuryNotes}} - {{.InjuryNotes}}{{end}}</div>
                                    {{end}}
                                    {{if .Source}}
                                    <div class="news-source">Source: {{.Source}}</div>
                                    {{end}}
                                </div>
                                {{end}}
                            </div>
                        </div>
                    </div>
                    {{else}}
                    <div class="toolkit-card collapseable">
                        <div class="card-header" onclick="toggleSection('player-news-{{$i}}')">
                            <span class="card-title">
                                Player News
                                <span class="news-count">0</span>
                            </span>
                            <span class="collapse-icon" id="player-news-{{$i}}-icon">‚ñº</span>
                        </div>
                        <div class="card-content" id="player-news-{{$i}}-content">
                            <div class="empty-state">
                                <div class="empty-state-icon">üì∞</div>
                                <div class="empty-state-title">No Recent News</div>
                                <div class="empty-state-text">
                                    All your players are flying under the radar. Check back later for updates.
                                </div>
                            </div>
                        </div>
                    </div>
                    {{end}}

                    <div class="toolkit-card collapseable">
                        <div class="card-header" onclick="toggleSection('breakout-{{$i}}')">
                            <span class="card-title">
                                Breakout Candidates
                                <span class="breakout-count">{{len $l.BreakoutCandidates}}</span>
                            </span>
                            <span class="collapse-icon" id="breakout-{{$i}}-icon">‚ñº</span>
                        </div>
                        <div class="card-content" id="breakout-{{$i}}-content">
                            {{if $l.BreakoutCandidates}}
                            <div class="breakout-desc">Young players with high upside potential (age &lt; 25, value &gt; 500)</div>
                            <div class="player-list">
                                {{range $l.BreakoutCandidates}}
                                <div class="player-card breakout-card">
                                    <div class="player-card-header">
                                        <span class="player-card-name">{{.Name | safe}}</span>
                                        <span class="player-card-age">Age {{.Age}}</span>
                                    </div>
                                    <div class="player-card-details">
                                        <span class="player-card-pos">{{.Pos}}</span>
                                        <span class="player-card-value">Value: {{.DynastyValue}}</span>
                                    </div>
                                </div>
                                {{end}}
                            </div>
                            {{else}}
                            <div class="empty-state">
                                <div class="empty-state-icon">üåü</div>
                                <div class="empty-state-title">No Breakout Candidates</div>
                                <div class="empty-state-text">
                                    You don't have young bench players (age &lt; 25) with significant value (&gt; 500). Consider adding high-upside rookies or young players to your roster!
                                </div>
                            </div>
                            {{end}}
                        </div>
                    </div>

                    <div class="toolkit-card collapseable">
                        <div class="card-header" onclick="toggleSection('aging-{{$i}}')">
                            <span class="card-title">
                                Aging Players Alert
                                <span class="aging-count">{{len $l.AgingPlayers}}</span>
                            </span>
                            <span class="collapse-icon" id="aging-{{$i}}-icon">‚ñº</span>
                        </div>
                        <div class="card-content" id="aging-{{$i}}-content">
                            {{if $l.AgingPlayers}}
                            <div class="aging-desc">Players approaching decline - consider selling while value is high</div>
                            <div class="player-list">
                                {{range $l.AgingPlayers}}
                                <div class="player-card aging-card">
                                    <div class="player-card-header">
                                        <span class="player-card-name">{{.Name | safe}}</span>
                                        <span class="player-card-age aging-age">Age {{.Age}}</span>
                                    </div>
                                    <div class="player-card-details">
                                        <span class="player-card-pos">{{.Pos}}</span>
                                        <span class="player-card-value">Value: {{.DynastyValue}}</span>
                                    </div>
                                    <div class="aging-warning">
                                        {{if eq .Pos "RB"}}‚ö†Ô∏è RBs decline sharply after age 28
                                        {{else if or (eq .Pos "WR") (eq .Pos "TE")}}‚ö†Ô∏è Pass catchers typically decline after 30
                                        {{else if eq .Pos "QB"}}‚ö†Ô∏è QBs can play longer but decline risk increases
                                        {{end}}
                                    </div>
                                </div>
                                {{end}}
                            </div>
                            {{else}}
                            <div class="empty-state">
                                <div class="empty-state-icon">‚úÖ</div>
                                <div class="empty-state-title">No Aging Concerns</div>
                                <div class="empty-state-text">
                                    Your valuable players are in their prime! No players currently flagged as approaching decline based on position-specific age thresholds.
                                </div>
                            </div>
                            {{end}}
                        </div>
                    </div>

                    <div class="toolkit-card collapseable">
                        <div class="card-header" onclick="toggleSection('transactions-{{$i}}')">
                            <span class="card-title">
                                Recent Transactions
                                <span class="transactions-count">{{len $l.RecentTransactions}}</span>
                            </span>
                            <span class="collapse-icon" id="transactions-{{$i}}-icon">‚ñº</span>
                        </div>
                        <div class="card-content" id="transactions-{{$i}}-content">
                            {{if $l.RecentTransactions}}
                            <div class="transaction-filters">
                                <button class="filter-btn active" onclick="filterTransactions(event, {{$i}}, 'all')">All</button>
                                <button class="filter-btn" onclick="filterTransactions(event, {{$i}}, 'trade')">üìä Trades</button>
                                <button class="filter-btn" onclick="filterTransactions(event, {{$i}}, 'waiver')">üìã Waivers</button>
                                <button class="filter-btn" onclick="filterTransactions(event, {{$i}}, 'free_agent')">‚ûï Free Agents</button>
                            </div>
                            <div class="transactions-list" id="transactions-list-{{$i}}">
                                {{range $l.RecentTransactions}}
                                <div class="transaction-item transaction-{{.Type}}">
                                    <div class="transaction-header">
                                        <span class="transaction-type">{{if eq .Type "trade"}}üìä Trade{{else if eq .Type "waiver"}}üìã Waiver{{else}}‚ûï Free Agent{{end}}</span>
                                        <span class="transaction-time">{{formatTime .Timestamp}}</span>
                                    </div>

                                    {{if eq .Type "trade"}}
                                        {{if and .Team1 .Team2}}
                                        <div class="trade-details">
                                            <div class="trade-side">
                                                <div class="trade-team">{{.Team1}}</div>
                                                {{if .Team1Gave}}
                                                <div class="trade-action">
                                                    <span class="trade-label gave">Gave:</span>
                                                    {{range .Team1Gave}}<div class="trade-player">{{.}}</div>{{end}}
                                                    {{if gt .Team1GaveValue 0}}
                                                    <div class="trade-value gave-value">Total Value: {{.Team1GaveValue}}</div>
                                                    {{end}}
                                                </div>
                                                {{end}}
                                                {{if .Team2Gave}}
                                                <div class="trade-action">
                                                    <span class="trade-label got">Got:</span>
                                                    {{range .Team2Gave}}<div class="trade-player">{{.}}</div>{{end}}
                                                    {{if gt .Team2GaveValue 0}}
                                                    <div class="trade-value got-value">Total Value: {{.Team2GaveValue}}</div>
                                                    {{end}}
                                                </div>
                                                {{end}}
                                                {{if and (gt .Team1GaveValue 0) (gt .Team2GaveValue 0)}}
                                                <div class="trade-net-value {{if gt .NetValue 0}}positive{{else if lt .NetValue 0}}negative{{else}}neutral{{end}}">
                                                    {{if gt .NetValue 0}}‚úÖ Gained {{.NetValue}} value{{else if lt .NetValue 0}}‚ùå Lost {{absInt .NetValue}} value{{else}}‚û°Ô∏è Even trade{{end}}
                                                </div>
                                                {{end}}
                                            </div>
                                            <div class="trade-divider">‚áÑ</div>
                                            <div class="trade-side">
                                                <div class="trade-team">{{.Team2}}</div>
                                                {{if .Team2Gave}}
                                                <div class="trade-action">
                                                    <span class="trade-label gave">Gave:</span>
                                                    {{range .Team2Gave}}<div class="trade-player">{{.}}</div>{{end}}
                                                    {{if gt .Team2GaveValue 0}}
                                                    <div class="trade-value gave-value">Total Value: {{.Team2GaveValue}}</div>
                                                    {{end}}
                                                </div>
                                                {{end}}
                                                {{if .Team1Gave}}
                                                <div class="trade-action">
                                                    <span class="trade-label got">Got:</span>
                                                    {{range .Team1Gave}}<div class="trade-player">{{.}}</div>{{end}}
                                                    {{if gt .Team1GaveValue 0}}
                                                    <div class="trade-value got-value">Total Value: {{.Team1GaveValue}}</div>
                                                    {{end}}
                                                </div>
                                                {{end}}
                                                {{if and (gt .Team1GaveValue 0) (gt .Team2GaveValue 0)}}
                                                <div class="trade-net-value {{if lt .NetValue 0}}positive{{else if gt .NetValue 0}}negative{{else}}neutral{{end}}">
                                                    {{if lt .NetValue 0}}‚úÖ Gained {{absInt .NetValue}} value{{else if gt .NetValue 0}}‚ùå Lost {{.NetValue}} value{{else}}‚û°Ô∏è Even trade{{end}}
                                                </div>
                                                {{end}}
                                            </div>
                                        </div>
                                        {{else}}
                                        <div class="transaction-desc">{{.Description}}</div>
                                        {{end}}
                                    {{else if eq .Type "waiver"}}
                                        <div class="waiver-details">
                                            {{if .TeamNames}}
                                            <div class="waiver-team">{{index .TeamNames 0}}</div>
                                            {{end}}
                                            <div class="waiver-action">
                                                <span class="waiver-label got">‚úÖ Added:</span> {{.AddedPlayer}}
                                            </div>
                                            {{if .DroppedPlayer}}
                                            <div class="waiver-action">
                                                <span class="waiver-label gave">‚ùå Dropped:</span> {{.DroppedPlayer}}
                                            </div>
                                            {{end}}
                                        </div>
                                    {{else}}
                                        <div class="waiver-details">
                                            {{if .TeamNames}}
                                            <div class="waiver-team">{{index .TeamNames 0}}</div>
                                            {{end}}
                                            <div class="waiver-action">
                                                <span class="waiver-label got">‚úÖ Added:</span> {{.AddedPlayer}}
                                            </div>
                                            {{if .DroppedPlayer}}
                                            <div class="waiver-action">
                                                <span class="waiver-label gave">‚ùå Dropped:</span> {{.DroppedPlayer}}
                                            </div>
                                            {{end}}
                                        </div>
                                    {{end}}
                                </div>
                                {{end}}
                            </div>
                            {{else}}
                            <div class="empty-state">
                                <div class="empty-state-icon">üìã</div>
                                <div class="empty-state-title">No Recent Activity</div>
                                <div class="empty-state-text">
                                    Your league has been quiet lately. No trades, waiver claims, or free agent moves in the past 4 weeks.
                                </div>
                            </div>
                            {{end}}
                        </div>
                    </div>

                    {{if or (gt (len $l.LeagueTrends.MostActiveTeams) 0) (gt (len $l.LeagueTrends.HotWaiverPlayers) 0)}}
                    <div class="toolkit-card collapseable">
                        <div class="card-header" onclick="toggleSection('league-trends-{{$i}}')">
                            <span class="card-title">League Trends</span>
                            <span class="collapse-icon" id="league-trends-{{$i}}-icon">‚ñº</span>
                        </div>
                        <div class="card-content" id="league-trends-{{$i}}-content">
                            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px;margin-bottom:20px;">
                                <div style="background:rgba(123,176,255,0.08);border:1px solid rgba(123,176,255,0.2);border-radius:8px;padding:16px;text-align:center;">
                                    <div style="font-size:2em;font-weight:700;color:#7bb0ff;">{{$l.LeagueTrends.TradeVolume}}</div>
                                    <div style="font-size:0.9em;color:#9fb3d4;margin-top:4px;">Trades (4 weeks)</div>
                                </div>
                                <div style="background:rgba(255,157,92,0.08);border:1px solid rgba(255,157,92,0.2);border-radius:8px;padding:16px;text-align:center;">
                                    <div style="font-size:2em;font-weight:700;color:#ff9d5c;">{{$l.LeagueTrends.WaiverVolume}}</div>
                                    <div style="font-size:0.9em;color:#9fb3d4;margin-top:4px;">Waiver Claims (4 weeks)</div>
                                </div>
                            </div>

                            {{if gt (len $l.LeagueTrends.MostActiveTeams) 0}}
                            <div style="margin-bottom:24px;">
                                <div style="font-weight:600;color:#c5d5f0;margin-bottom:12px;font-size:0.95em;">Most Active Teams</div>
                                <div class="table-scroll">
                                <table class="age-chart-table">
                                    <thead>
                                        <tr>
                                            <th style="text-align:left;">Team</th>
                                            <th>Transactions</th>
                                            <th>Trades</th>
                                            <th>Waivers</th>
                                            <th>Activity</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    {{range $l.LeagueTrends.MostActiveTeams}}
                                        <tr>
                                            <td style="text-align:left;">{{.TeamName}}</td>
                                            <td>{{.Transactions}}</td>
                                            <td>{{.Trades}}</td>
                                            <td>{{.WaiverClaims}}</td>
                                            <td>
                                                {{if eq .ActivityLevel "Very Active"}}
                                                    <span style="color:#3ae87a;font-weight:600;">Very Active</span>
                                                {{else if eq .ActivityLevel "Active"}}
                                                    <span style="color:#7bb0ff;font-weight:600;">Active</span>
                                                {{else}}
                                                    <span style="color:#9fb3d4;">Quiet</span>
                                                {{end}}
                                            </td>
                                        </tr>
                                    {{end}}
                                    </tbody>
                                </table>
                                </div>
                            </div>
                            {{end}}

                            {{if gt (len $l.LeagueTrends.HotWaiverPlayers) 0}}
                            <div style="margin-bottom:24px;">
                                <div style="font-weight:600;color:#c5d5f0;margin-bottom:12px;font-size:0.95em;">Hot Waiver Players</div>
                                <div style="font-size:0.85em;color:#9fb3d4;font-style:italic;margin-bottom:12px;">Players claimed multiple times in the past 4 weeks</div>
                                <div class="table-scroll">
                                <table class="age-chart-table">
                                    <thead>
                                        <tr>
                                            <th style="text-align:left;">Player</th>
                                            <th>Pos</th>
                                            <th>Claims</th>
                                            <th>Last Claimed</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    {{range $l.LeagueTrends.HotWaiverPlayers}}
                                        <tr>
                                            <td style="text-align:left;">{{.PlayerName}}</td>
                                            <td>{{.Position}}</td>
                                            <td style="font-weight:600;color:#ff9d5c;">{{.ClaimCount}}</td>
                                            <td style="color:#9fb3d4;font-size:0.9em;">{{.LastClaimed}}</td>
                                        </tr>
                                    {{end}}
                                    </tbody>
                                </table>
                                </div>
                            </div>
                            {{end}}

                            {{if $l.LeagueTrends.PositionScarcity}}
                            <div>
                                <div style="font-weight:600;color:#c5d5f0;margin-bottom:12px;font-size:0.95em;">Position Scarcity</div>
                                <div style="font-size:0.85em;color:#9fb3d4;font-style:italic;margin-bottom:12px;">Available players by position on waivers</div>
                                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:12px;">
                                    {{range $pos, $count := $l.LeagueTrends.PositionScarcity}}
                                    <div style="background:rgba(30,38,54,0.5);border:1px solid rgba(123,176,255,0.15);border-radius:6px;padding:12px;text-align:center;">
                                        <div style="font-size:1.5em;font-weight:700;color:#7bb0ff;">{{$count}}</div>
                                        <div style="font-size:0.85em;color:#9fb3d4;margin-top:4px;">{{$pos}}</div>
                                    </div>
                                    {{end}}
                                </div>
                            </div>
                            {{end}}
                        </div>
                    </div>
                    {{end}}

                    {{if $l.DraftPicks}}
                    <div class="toolkit-card collapseable">
                        <div class="card-header" onclick="toggleSection('draft-picks-{{$i}}')">
                            <span class="card-title">Draft Capital</span>
                            <span class="collapse-icon" id="draft-picks-{{$i}}-icon">‚ñº</span>
                        </div>
                        <div class="card-content" id="draft-picks-{{$i}}-content">
                            <div class="draft-picks-grid">
                                {{range $l.DraftPicks}}
                                <div class="draft-pick-card{{if .OriginalName}} traded-pick{{end}}">
                                    <div class="pick-year">{{.Year}}</div>
                                    <div class="pick-round">Round {{.Round}}</div>
                                    {{if .OriginalName}}
                                    <div class="pick-origin">from {{.OriginalName}}</div>
                                    {{end}}
                                </div>
                                {{end}}
                            </div>
                        </div>
                    </div>
                    {{end}}

                    {{if $l.ProjectedDraftPicks}}
                    <div class="toolkit-card collapseable">
                        <div class="card-header" onclick="toggleSection('projected-picks-{{$i}}')">
                            <span class="card-title">2026 Rookie Draft Projections</span>
                            <span class="collapse-icon" id="projected-picks-{{$i}}-icon">‚ñº</span>
                        </div>
                        <div class="card-content" id="projected-picks-{{$i}}-content">
                            <div class="rookies-desc" style="font-size:0.85em;color:#9fb3d4;font-style:italic;margin-bottom:12px;">
                                Projected draft positions based on current standings. Worst record gets pick 1.01.
                            </div>
                            <div class="table-scroll">
                            <div class="table-scroll">
                            <table class="age-chart-table">
                                <thead>
                                    <tr>
                                        <th style="text-align:center;">Year</th>
                                        <th style="text-align:center;">Round</th>
                                        <th style="text-align:center;">Projected Pick</th>
                                        <th style="text-align:left;">Owner</th>
                                        <th style="text-align:center;">Current Standing</th>
                                        <th style="text-align:center;">Record</th>
                                    </tr>
                                </thead>
                                <tbody>
                                {{range $l.ProjectedDraftPicks}}
                                    <tr{{if .IsYours}} style="background:rgba(123,176,255,0.15);border-left:3px solid #7bb0ff;"{{end}}>
                                        <td style="text-align:center;font-weight:700;color:#7bb0ff;">{{.Year}}</td>
                                        <td style="text-align:center;">{{.Round}}</td>
                                        <td style="text-align:center;font-weight:700;color:#3ae87a;">{{.Round}}.{{printf "%02d" .ProjectedPosition}}</td>
                                        <td style="text-align:left;">
                                            {{if .OriginalOwner}}
                                                {{.OwnerName}} <span style="color:#3ae87a;font-size:0.85em;font-style:italic;">(from {{.OriginalOwner}})</span>
                                            {{else}}
                                                {{.OwnerName}}
                                            {{end}}
                                        </td>
                                        <td style="text-align:center;">{{.CurrentStanding}}</td>
                                        <td style="text-align:center;color:#9fb3d4;">{{.TeamRecord}}</td>
                                    </tr>
                                {{end}}
                                </tbody>
                            </table>
                            </div>
                            </div>
                        </div>
                    </div>
                    {{end}}

                    {{if $l.TeamAges}}
                    <div class="toolkit-card collapseable">
                        <div class="card-header" onclick="toggleSection('league-age-{{$i}}')">
                            <span class="card-title">League Age Analysis</span>
                            <span class="collapse-icon" id="league-age-{{$i}}-icon">‚ñº</span>
                        </div>
                        <div class="card-content" id="league-age-{{$i}}-content">
                            <div class="age-chart-desc" style="margin-bottom:12px;">Teams sorted by roster age (oldest to youngest)</div>
                            <div class="table-scroll">
                            <table class="age-chart-table">
                                <thead>
                                    <tr>
                                        <th style="text-align:left;">Team</th>
                                        <th>Avg Age</th>
                                        <th>Roster Value</th>
                                        <th>Wins</th>
                                        <th>Strategy</th>
                                    </tr>
                                </thead>
                                <tbody>
                                {{range $l.TeamAges}}
                                    <tr{{if .IsUserTeam}} style="background:rgba(123,176,255,0.15);border-left:3px solid #7bb0ff;"{{end}}>
                                        <td style="text-align:left;">
                                            {{if .IsUserTeam}}<b>{{.TeamName}}</b> (You){{else}}{{.TeamName}}{{end}}
                                        </td>
                                        <td>{{printf "%.1f" .AvgAge}}</td>
                                        <td>{{if .RosterValue}}{{.RosterValue}}{{else}}-{{end}}</td>
                                        <td>{{.Rank}}</td>
                                        <td>
                                            {{if gt .AvgAge 27.0}}
                                                <span style="color:#ff9d5c;">Win Now</span>
                                            {{else if lt .AvgAge 24.5}}
                                                <span style="color:#7bb0ff;">Rebuild</span>
                                            {{else}}
                                                <span style="color:#3ae87a;">Contending</span>
                                            {{end}}
                                        </td>
                                    </tr>
                                {{end}}
                                </tbody>
                            </table>
                            </div>
                        </div>
                    </div>
                    {{end}}

                    {{if $l.PowerRankings}}
                    <div class="toolkit-card collapseable">
                        <div class="card-header" onclick="toggleSection('power-rankings-{{$i}}')">
                            <span class="card-title">League Power Rankings</span>
                            <span class="collapse-icon" id="power-rankings-{{$i}}-icon">‚ñº</span>
                        </div>
                        <div class="card-content" id="power-rankings-{{$i}}-content">
                            <div class="age-chart-desc" style="margin-bottom:12px;">Combined ranking based on dynasty value and current record</div>
                            <table class="age-chart-table">
                                <thead>
                                    <tr>
                                        <th style="text-align:center;">Rank</th>
                                        <th style="text-align:left;">Team</th>
                                        <th>Value</th>
                                        <th>Record</th>
                                        <th>Strategy</th>
                                    </tr>
                                </thead>
                                <tbody>
                                {{range $l.PowerRankings}}
                                    <tr{{if .IsUserTeam}} style="background:rgba(123,176,255,0.15);border-left:3px solid #7bb0ff;"{{end}}>
                                        <td style="text-align:center;font-weight:700;color:#7bb0ff;">{{.Rank}}</td>
                                        <td style="text-align:left;">
                                            {{if .IsUserTeam}}<b>{{.TeamName}}</b> (You){{else}}{{.TeamName}}{{end}}
                                        </td>
                                        <td style="font-weight:600;">{{.RosterValue}}</td>
                                        <td>{{.Wins}}-{{.Losses}}</td>
                                        <td>
                                            {{if eq .Strategy "Win Now"}}
                                                <span style="color:#ff9d5c;">Win Now</span>
                                            {{else if eq .Strategy "Rebuilding"}}
                                                <span style="color:#7bb0ff;">Rebuilding</span>
                                            {{else}}
                                                <span style="color:#3ae87a;">Contending</span>
                                            {{end}}
                                        </td>
                                    </tr>
                                {{end}}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    {{end}}

                    <div class="toolkit-card collapseable">
                        <div class="card-header" onclick="toggleSection('trade-targets-{{$i}}')">
                            <span class="card-title">
                                Trade Targets
                                <span class="info-icon" title="Shows teams with complementary needs based on positional value distribution. Requires clear surplus (>30%) and deficit (<15%) positions.">?</span>
                            </span>
                            <span class="collapse-icon" id="trade-targets-{{$i}}-icon">‚ñº</span>
                        </div>
                        <div class="card-content" id="trade-targets-{{$i}}-content">
                            {{if $l.TradeTargets}}
                                <div class="trade-targets-desc" style="margin-bottom:16px;font-size:0.85em;color:#9fb3d4;font-style:italic;">Potential trade partners based on positional complementarity</div>
                                {{range $l.TradeTargets}}
                                <div class="trade-target-item">
                                    <div class="target-team">{{.TeamName}}</div>
                                    <div class="target-reason">{{.Reason}}</div>
                                    <div class="target-details">
                                        <div class="surplus-row">
                                            <span class="surplus-label">You offer:</span>
                                            <span class="surplus-value">{{.YourSurplus}} ({{.YourSurplusKTC}} value)</span>
                                        </div>
                                        <div class="surplus-row">
                                            <span class="surplus-label">They offer:</span>
                                            <span class="surplus-value">{{.TheirSurplus}} ({{.TheirSurplusKTC}} value)</span>
                                        </div>
                                    </div>
                                </div>
                                {{end}}
                            {{else}}
                                <div class="empty-state">
                                    <div class="empty-state-icon">ü§ù</div>
                                    <div class="empty-state-title">No Trade Recommendations</div>
                                    <div class="empty-state-text">
                                        Your roster is well-balanced! Trade targets appear when you have a clear positional surplus (>30% of total value) and deficit (<15% of total value).
                                    </div>
                                    {{if gt $l.TotalRosterValue 0}}
                                    <div class="positional-breakdown">
                                        <div class="breakdown-title">Your Positional Breakdown</div>
                                        <div class="breakdown-grid">
                                            {{$total := $l.TotalRosterValue}}
                                            {{if gt $l.PositionalBreakdown.QB 0}}
                                            <div class="breakdown-item">
                                                <span class="breakdown-pos">QB</span>
                                                <span class="breakdown-bar-wrap">
                                                    <span class="breakdown-bar" style="width: {{printf "%.0f" (mul (div (float64 $l.PositionalBreakdown.QB) (float64 $total)) 100)}}%"></span>
                                                </span>
                                                <span class="breakdown-pct">{{printf "%.1f" (mul (div (float64 $l.PositionalBreakdown.QB) (float64 $total)) 100)}}%</span>
                                            </div>
                                            {{end}}
                                            {{if gt $l.PositionalBreakdown.RB 0}}
                                            <div class="breakdown-item">
                                                <span class="breakdown-pos">RB</span>
                                                <span class="breakdown-bar-wrap">
                                                    <span class="breakdown-bar" style="width: {{printf "%.0f" (mul (div (float64 $l.PositionalBreakdown.RB) (float64 $total)) 100)}}%"></span>
                                                </span>
                                                <span class="breakdown-pct">{{printf "%.1f" (mul (div (float64 $l.PositionalBreakdown.RB) (float64 $total)) 100)}}%</span>
                                            </div>
                                            {{end}}
                                            {{if gt $l.PositionalBreakdown.WR 0}}
                                            <div class="breakdown-item">
                                                <span class="breakdown-pos">WR</span>
                                                <span class="breakdown-bar-wrap">
                                                    <span class="breakdown-bar" style="width: {{printf "%.0f" (mul (div (float64 $l.PositionalBreakdown.WR) (float64 $total)) 100)}}%"></span>
                                                </span>
                                                <span class="breakdown-pct">{{printf "%.1f" (mul (div (float64 $l.PositionalBreakdown.WR) (float64 $total)) 100)}}%</span>
                                            </div>
                                            {{end}}
                                            {{if gt $l.PositionalBreakdown.TE 0}}
                                            <div class="breakdown-item">
                                                <span class="breakdown-pos">TE</span>
                                                <span class="breakdown-bar-wrap">
                                                    <span class="breakdown-bar" style="width: {{printf "%.0f" (mul (div (float64 $l.PositionalBreakdown.TE) (float64 $total)) 100)}}%"></span>
                                                </span>
                                                <span class="breakdown-pct">{{printf "%.1f" (mul (div (float64 $l.PositionalBreakdown.TE) (float64 $total)) 100)}}%</span>
                                            </div>
                                            {{end}}
                                        </div>
                                    </div>
                                    {{end}}
                                </div>
                            {{end}}
                        </div>
                    </div>

                    {{if $l.TopRookies}}
                    <div class="toolkit-card collapseable">
                        <div class="card-header" onclick="toggleSection('rookies-2025-{{$i}}')">
                            <span class="card-title">2025 NFL Draft Class</span>
                            <span class="collapse-icon" id="rookies-2025-{{$i}}-icon">‚ñº</span>
                        </div>
                        <div class="card-content" id="rookies-2025-{{$i}}-content">
                            <div class="rookies-desc" style="font-size:0.85em;color:#9fb3d4;font-style:italic;margin-bottom:12px;">Top fantasy-relevant rookies from the 2025 NFL Draft (with NFL teams)</div>
                            <div class="table-scroll">
                            <table class="rookies-table">
                                <thead>
                                    <tr>
                                        <th style="text-align:center;">Rank</th>
                                        <th>Player</th>
                                        <th>Pos</th>
                                        <th>College</th>
                                        <th style="text-align:right;">Value</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {{range $l.TopRookies}}
                                    {{if eq .Year 2025}}
                                    <tr>
                                        <td style="text-align:center;font-weight:700;color:#7bb0ff;">{{.Rank}}</td>
                                        <td style="font-weight:600;">{{.Name}}</td>
                                        <td>{{.Position}}</td>
                                        <td style="font-size:0.9em;color:#9fb3d4;">{{.College}}</td>
                                        <td style="text-align:right;font-weight:600;">{{.Value}}</td>
                                    </tr>
                                    {{end}}
                                    {{end}}
                                </tbody>
                            </table>
                            </div>
                        </div>
                    </div>

                    <div class="toolkit-card collapseable">
                        <div class="card-header" onclick="toggleSection('rookies-2026-{{$i}}')">
                            <span class="card-title">2026 NFL Draft Prospects</span>
                            <span class="collapse-icon" id="rookies-2026-{{$i}}-icon">‚ñº</span>
                        </div>
                        <div class="card-content" id="rookies-2026-{{$i}}-content">
                            <div class="rookies-desc" style="font-size:0.85em;color:#9fb3d4;font-style:italic;margin-bottom:12px;">Top 2026 dynasty rookie rankings based on consensus big boards. Subject to change as the college season progresses.</div>
                            <div class="table-scroll">
                            <table class="rookies-table">
                                <thead>
                                    <tr>
                                        <th style="text-align:center;">Rank</th>
                                        <th>Player</th>
                                        <th>Pos</th>
                                        <th>College</th>
                                        <th style="text-align:right;">Value</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {{range $l.TopRookies}}
                                    {{if eq .Year 2026}}
                                    <tr>
                                        <td style="text-align:center;font-weight:700;color:#7bb0ff;">{{.Rank}}</td>
                                        <td style="font-weight:600;">{{.Name}}</td>
                                        <td>{{.Position}}</td>
                                        <td style="font-size:0.9em;color:#9fb3d4;">{{.College}}</td>
                                        <td style="text-align:right;font-weight:600;">{{.Value}}</td>
                                    </tr>
                                    {{end}}
                                    {{end}}
                                </tbody>
                            </table>
                            </div>
                        </div>
                    </div>
                    {{end}}
                </div>
                {{end}}
            </div>

            {{if $l.TopFreeAgents}}
            <div class="fa-section {{if $l.IsDynasty}}inseason-only{{end}}">
                <div class="fa-header">Recommended Free Agents (Tier-Based)</div>
                <div class="table-scroll">
                <table class="sortable-table pretty-table">
                    <thead>
                        <tr><th>Pos</th><th>Player</th><th>Tier</th>{{if $l.IsDynasty}}<th>Dynasty Value</th>{{end}}</tr>
                    </thead>
                    <tbody>
                    {{range $l.TopFreeAgents}}
                        <tr{{if .IsUpgrade}} class="fa-upgrade"{{end}}>
                            <td>{{.Pos}}</td>
                            <td>
                                {{if .IsUpgrade}}<span class="fa-upgrade-icon">‚¨Ü</span> {{end}}{{.Name | safe}}
                                {{if .IsUpgrade}}
                                    <div style="font-size:0.85em;color:#3ae87a;margin-top:2px;">Upgrade for {{.UpgradeType}}: {{.UpgradeFor}}</div>
                                {{end}}
                            </td>
                            <td>{{.Tier}}</td>
                            {{if $l.IsDynasty}}<td>{{if .DynastyValue}}{{.DynastyValue}}{{else}}-{{end}}</td>{{end}}
                        </tr>
                    {{end}}
                    </tbody>
                </table>
                </div>
            </div>
            {{end}}

            {{if $l.TopFreeAgentsByValue}}
            <div class="fa-section dynasty-only">
                <div class="fa-header">Top Available Players (Dynasty Value)</div>
                <div class="table-scroll">
                <table class="sortable-table pretty-table">
                    <thead>
                        <tr><th>Pos</th><th>Player</th><th>Dynasty Value</th></tr>
                    </thead>
                    <tbody>
                    {{range $l.TopFreeAgentsByValue}}
                        <tr{{if .IsUpgrade}} class="fa-upgrade"{{end}}>
                            <td>{{.Pos}}</td>
                            <td>
                                {{if .IsUpgrade}}<span class="fa-upgrade-icon">‚¨Ü</span> {{end}}{{.Name | safe}}
                                {{if .IsUpgrade}}
                                    <div style="font-size:0.85em;color:#3ae87a;margin-top:2px;">Upgrade for {{.UpgradeType}}: {{.UpgradeFor}}</div>
                                {{end}}
                            </td>
                            <td>{{.DynastyValue}}</td>
                        </tr>
                    {{end}}
                    </tbody>
                </table>
                </div>
            </div>
            {{end}}

            <br>
        </div>
    {{end}}
</div>

<div class="legend" style="margin-top:32px; margin-bottom:24px; font-size:0.9em; color:#c5d5f0; display:flex; flex-wrap:wrap; gap:20px; align-items:center; justify-content:center; padding:16px; background:rgba(30,38,54,0.4); border-radius:12px; backdrop-filter:blur(10px); border:1px solid rgba(123,176,255,0.1);">
    <span style="font-weight:600; margin-right:8px; color:#7bb0ff; text-transform:uppercase; letter-spacing:0.5px; font-size:0.85em;">Legend:</span>
    <span style="display:inline-flex; align-items:center; gap:6px;"><span class="tier1-star">‚òÖ</span> <span style="font-weight:500;">Tier 1</span></span>
    <span style="display:inline-flex; align-items:center; gap:6px;"><span style="background:#7bb0ff;color:#1a1f2e;padding:3px 7px;border-radius:6px;font-size:0.8em;font-weight:bold;">FLEX</span> <span style="font-weight:500;">FLEX tier</span></span>
    <span style="display:inline-flex; align-items:center; gap:6px;"><span class="swap-icon">‚áÑ</span> <span style="font-weight:500;">Swap</span></span>
    <span style="display:inline-flex; align-items:center; gap:6px;"><span style="background:#3a1e1e; color:#ffb6b6; padding:3px 8px; border-radius:6px; font-weight:500;">Red</span> <span style="font-weight:500;">Suboptimal</span></span>
</div>

</div>
<script>
// Initialize default tab
if (document.getElementById('defaultTab')) document.getElementById('defaultTab').click();

// Initialize dynasty leagues to dynasty mode
{{range $i, $l := .Leagues}}
{{if $l.IsDynasty}}
(function() {
    const league = document.getElementById('league{{$i}}');
    if (league) {
        // Hide in-season content, show dynasty content
        league.querySelectorAll('.inseason-only').forEach(el => el.style.display = 'none');
        league.querySelectorAll('.dynasty-only').forEach(el => el.style.display = '');
    }
})();
{{end}}
{{end}}
</script>
    <script src="/static/sortable.js"></script>
    <script src="/static/theme.js"></script>

<footer class="site-footer">
    <div class="footer-content">
        <div class="footer-links">
            <a href="https://www.borischen.co/" target="_blank" rel="noopener">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M8 0L10 6H16L11 10L13 16L8 12L3 16L5 10L0 6H6L8 0Z"/>
                </svg>
                Boris Chen Tiers
            </a>
            <a href="https://github.com/wbollock/sleeperPy" target="_blank" rel="noopener">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                </svg>
                GitHub
            </a>
            <a href="/pricing" rel="noopener">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M2 4a1 1 0 011-1h10a1 1 0 011 1v8a1 1 0 01-1 1H3a1 1 0 01-1-1V4z"/>
                    <path d="M8 7a1 1 0 100 2 1 1 0 000-2z"/>
                </svg>
                Pricing
            </a>
            <a href="/privacy" rel="noopener">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M8 1L3 3v4c0 3.5 2 6 5 8 3-2 5-4.5 5-8V3l-5-2z"/>
                </svg>
                Privacy
            </a>
            <a href="/terms" rel="noopener">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M4 2a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2V4a2 2 0 00-2-2H4zm0 2h8v8H4V4z"/>
                    <path d="M6 6h4v1H6V6zm0 2h4v1H6V8zm0 2h2v1H6v-1z"/>
                </svg>
                Terms
            </a>
            <a href="/about" rel="noopener">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="1.5" fill="none"/>
                    <path d="M8 4.5a1 1 0 110 2 1 1 0 010-2zM7 8h2v4H7V8z"/>
                </svg>
                About
            </a>
            <a href="/faq" rel="noopener">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="1.5" fill="none"/>
                    <path d="M6 6a2 2 0 114 0c0 1-1 1.5-1.5 2H7.5c.5-1 1.5-1 1.5-2a1 1 0 10-2 0H6zm2 4.5a.75.75 0 110 1.5.75.75 0 010-1.5z"/>
                </svg>
                FAQ
            </a>
        </div>
        <div class="footer-cta">
            <a href="https://buymeacoffee.com/wbollock" target="_blank" rel="noopener" class="coffee-btn">
                ‚òï Buy Me a Coffee
            </a>
            <span class="footer-love">
                If you like this project, <a href="https://github.com/wbollock/sleeperPy" target="_blank" rel="noopener">star it on GitHub</a>
            </span>
        </div>
        <div class="footer-bottom">
            <p>Built by <a href="https://github.com/wbollock" target="_blank" rel="noopener">@wbollock</a> ‚Ä¢ Data from <a href="https://www.borischen.co" target="_blank" rel="noopener">Boris Chen</a> & <a href="https://dynastyprocess.com" target="_blank" rel="noopener">DynastyProcess</a></p>
        </div>
    </div>
</footer>
{{end}}
</main>

    <script src="/static/loading.js"></script>
    <script src="/static/theme.js"></script>
    <script src="/static/cookie-consent.js"></script>
    <script src="/static/sortable.js"></script>
<script>
async function clearAppCache() {
    try {
        if ('serviceWorker' in navigator) {
            const registrations = await navigator.serviceWorker.getRegistrations();
            for (const registration of registrations) {
                registration.active?.postMessage({ type: 'CLEAR_CACHE' });
                await registration.unregister();
            }
        }

        if ('caches' in window) {
            const cacheNames = await caches.keys();
            await Promise.all(cacheNames.map((name) => caches.delete(name)));
        }

        const url = new URL(window.location.href);
        url.searchParams.set('cachebust', Date.now().toString());
        window.location.replace(url.toString());
    } catch (error) {
        console.error('[CACHE] Failed to clear cache:', error);
        window.location.reload();
    }
}

// Register service worker for PWA offline support
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('/static/sw.js')
            .then((registration) => {
                console.log('[PWA] Service Worker registered:', registration.scope);

                // Check for updates periodically
                setInterval(() => {
                    registration.update();
                }, 60000); // Check every minute
            })
            .catch((error) => {
                console.log('[PWA] Service Worker registration failed:', error);
            });
    });
}
</script>
</body>
</html>

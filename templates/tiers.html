<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SleeperPy Tiers</title>
    <link rel="stylesheet" href="/static/main.css">
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
</head>
<body>
<header class="app-header">
    <h1><a href="/" style="color:inherit; text-decoration:none;">SleeperPy Fantasy Tiers</a></h1>
</header>
<div class="main-content">
{{if .Error}}
<span style="color:red">{{.Error}}</span>
{{else}}
{{with .Leagues}}
    {{/* Shareable link box removed as the URL is self-evident */}}
{{end}}

<script>
function showLeagueTab(evt, tabId) {
    document.querySelectorAll('.league-content').forEach(div => div.style.display = 'none');
    document.getElementById(tabId).style.display = 'block';
    document.querySelectorAll('.league-tab').forEach(btn => btn.classList.remove('active'));
    evt.currentTarget.classList.add('active');
}

function switchMode(leagueIndex, mode) {
    const league = document.getElementById('league' + leagueIndex);

    // Update button states
    const btns = league.querySelectorAll('.mode-btn');
    btns.forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');

    // Update description
    const inseasonDesc = league.querySelector('.inseason-desc');
    const dynastyDesc = league.querySelector('.dynasty-desc');

    // Toggle content visibility
    const inseasonContent = league.querySelectorAll('.inseason-only');
    const dynastyContent = league.querySelectorAll('.dynasty-only');

    if (mode === 'inseason') {
        inseasonDesc.style.display = 'inline';
        dynastyDesc.style.display = 'none';
        inseasonContent.forEach(el => el.style.display = '');
        dynastyContent.forEach(el => el.style.display = 'none');
    } else {
        inseasonDesc.style.display = 'none';
        dynastyDesc.style.display = 'inline';
        inseasonContent.forEach(el => el.style.display = 'none');
        dynastyContent.forEach(el => el.style.display = '');
    }
}
</script>

<div class="league-tabs">
    {{range $i, $l := .Leagues}}
        <button class="league-tab" {{if eq $i 0}}id="defaultTab"{{end}} onclick="showLeagueTab(event, 'league{{$i}}')">{{if $l.IsDynasty}}⭐ {{end}}{{$l.LeagueName}} ({{$l.Scoring}})</button>
    {{end}}
</div>
<div class="league-contents">
    {{range $i, $l := .Leagues}}
        <div class="league-content" id="league{{$i}}" style="display:{{if eq $i 0}}block{{else}}none{{end}};">
            {{if $l.IsDynasty}}
            <div class="mode-toggle-container">
                <div class="mode-toggle">
                    <button class="mode-btn active" onclick="switchMode({{$i}}, 'inseason')">In-Season</button>
                    <button class="mode-btn" onclick="switchMode({{$i}}, 'dynasty')">Dynasty</button>
                </div>
                <div class="mode-description">
                    <span class="inseason-desc">Weekly matchups & tier-based recommendations</span>
                    <span class="dynasty-desc" style="display:none;">Long-term value & dynasty toolkit</span>
                </div>
            </div>
            {{end}}
            <table class="sortable-table pretty-table">
                <thead>
                    <tr><th>Position</th><th>Player</th><th>Tier</th>{{if $l.IsDynasty}}<th>Dynasty Value</th>{{end}}</tr>
                </thead>
                <tbody>
                {{range $l.Starters}}
                    <tr{{if eq .Tier 1}} class="tier1"{{else if .IsTierWorseThanBench}} class="tier-worse"{{end}}>
                        <td>{{.Pos}}</td>
                        <td>{{if eq .Tier 1}}<span class="tier1-star">★</span> {{end}}{{.Name | safe}}</td>
                        <td>{{.Tier}}{{if .IsFlex}} <span style="background:#7bb0ff;color:#1a1f2e;padding:2px 5px;border-radius:3px;font-size:0.85em;font-weight:bold;">FLEX</span>{{else if .IsSuperflex}} <span style="background:#7bb0ff;color:#1a1f2e;padding:2px 5px;border-radius:3px;font-size:0.85em;font-weight:bold;">SF</span>{{end}}</td>
                        {{if $l.IsDynasty}}<td>{{if .DynastyValue}}{{.DynastyValue}}{{else}}-{{end}}</td>{{end}}
                    </tr>
                {{end}}
                {{range $l.Unranked}}
                    <tr>
                        <td>
                            {{if eq .Pos "FLEX"}}<span style="color:#7bb0ff;font-weight:bold;">FLEX</span>{{else if eq .Pos "SUPERFLEX"}}<span style="color:#7bb0ff;font-weight:bold;">SUPERFLEX</span>{{else}}{{.Pos}}{{end}}
                        </td>
                        <td>{{.Name | safe}}</td>
                        <td>{{.Tier}}</td>
                        {{if $l.IsDynasty}}<td>-</td>{{end}}
                    </tr>
                {{end}}
                </tbody>
                <tfoot>
                    <tr class="{{if $l.IsDynasty}}inseason-only{{end}}"><td colspan="{{if $l.IsDynasty}}4{{else}}3{{end}}" class="summary" style="padding:16px;"><b>Average Tier: {{$l.AvgTier}}</b></td></tr>
                    {{if $l.HasMatchups}}
                    <tr class="{{if $l.IsDynasty}}inseason-only{{end}}"><td colspan="{{if $l.IsDynasty}}4{{else}}3{{end}}" class="summary" style="padding:16px;"><b>Opponent Average Tier: {{$l.AvgOppTier}}</b></td></tr>
                    <tr class="{{if $l.IsDynasty}}inseason-only{{end}}">
                        <td colspan="{{if $l.IsDynasty}}4{{else}}3{{end}}" style="padding:12px 0; background:transparent; border:none; text-align:center;">
                            <div class="winprob-row">
                                <span class="winprob-label">Win Probability</span>
                                <span class="winprob-bar-wrap">
                                    <span class="winprob-bar-bg">
                                        <span class="winprob-bar" style="width: {{parseWinProb $l.WinProb}}%; background: {{winProbColor $l.WinProb}};"></span>
                                    </span>
                                </span>
                                <span class="winprob-badge" style="background: {{winProbColor $l.WinProb}};">
                                    {{parseWinProb $l.WinProb}}%
                                </span>
                                <span class="winprob-emoji">{{parseWinEmoji $l.WinProb}}</span>
                            </div>
                        </td>
                    </tr>
                    {{else}}
                    <tr class="{{if $l.IsDynasty}}inseason-only{{end}}"><td colspan="{{if $l.IsDynasty}}4{{else}}3{{end}}" class="summary" style="padding:16px;font-style:italic;color:#9fb3d4;">Offseason - No active matchups</td></tr>
                    {{end}}
                    {{if $l.IsDynasty}}
                    <tr class="dynasty-only" style="display:none;"><td colspan="4" class="summary" style="padding:16px;"><b>Total Roster Value: {{$l.TotalRosterValue}}</b></td></tr>
                    {{end}}
                    <tr><th colspan="{{if $l.IsDynasty}}4{{else}}3{{end}}" class="bench-header" style="padding-top:24px; padding-bottom:16px;">Bench</th></tr>
                    {{range $l.Bench}}
                        <tr{{if eq .Tier 1}} class="tier1"{{else if .ShouldSwapIn}} class="swap-candidate"{{end}}><td>{{.Pos}}</td><td>{{if eq .Tier 1}}<span class="tier1-star">★</span> {{end}}{{if .ShouldSwapIn}}<span class="swap-icon">⇄</span> {{end}}{{.Name | safe}}</td><td>{{.Tier}}{{if .IsFlex}} <span style="background:#7bb0ff;color:#1a1f2e;padding:2px 5px;border-radius:3px;font-size:0.85em;font-weight:bold;">FLEX</span>{{end}}</td>{{if $l.IsDynasty}}<td>{{if .DynastyValue}}{{.DynastyValue}}{{else}}-{{end}}</td>{{end}}</tr>
                    {{end}}
                    {{range $l.BenchUnranked}}
                        <tr><td>{{.Pos}}</td><td>{{.Name | safe}}</td><td>{{.Tier}}</td>{{if $l.IsDynasty}}<td>-</td>{{end}}</tr>
                    {{end}}
                    <tr><td colspan="{{if $l.IsDynasty}}4{{else}}3{{end}}" style="padding-top:8px;font-size:0.9em;color:#9fb3d4;font-style:italic;">Note: RB/WR/TE bench players ranked using FLEX tiers</td></tr>
                </tfoot>
            </table>

            {{if $l.TopFreeAgents}}
            <div class="fa-section {{if $l.IsDynasty}}inseason-only{{end}}">
                <div class="fa-header">Recommended Free Agents (Tier-Based)</div>
                <table class="sortable-table pretty-table">
                    <thead>
                        <tr><th>Pos</th><th>Player</th><th>Tier</th>{{if $l.IsDynasty}}<th>Dynasty Value</th>{{end}}</tr>
                    </thead>
                    <tbody>
                    {{range $l.TopFreeAgents}}
                        <tr{{if .IsUpgrade}} class="fa-upgrade"{{end}}>
                            <td>{{.Pos}}</td>
                            <td>
                                {{if .IsUpgrade}}<span class="fa-upgrade-icon">⬆</span> {{end}}{{.Name | safe}}
                                {{if .IsUpgrade}}
                                    <div style="font-size:0.85em;color:#3ae87a;margin-top:2px;">Upgrade for {{.UpgradeType}}: {{.UpgradeFor}}</div>
                                {{end}}
                            </td>
                            <td>{{.Tier}}</td>
                            {{if $l.IsDynasty}}<td>{{if .DynastyValue}}{{.DynastyValue}}{{else}}-{{end}}</td>{{end}}
                        </tr>
                    {{end}}
                    </tbody>
                </table>
            </div>
            {{end}}

            {{if $l.TopFreeAgentsByValue}}
            <div class="fa-section dynasty-only" style="display:none;">
                <div class="fa-header">Top Available Players (Dynasty Value)</div>
                <table class="sortable-table pretty-table">
                    <thead>
                        <tr><th>Pos</th><th>Player</th><th>Dynasty Value</th></tr>
                    </thead>
                    <tbody>
                    {{range $l.TopFreeAgentsByValue}}
                        <tr{{if .IsUpgrade}} class="fa-upgrade"{{end}}>
                            <td>{{.Pos}}</td>
                            <td>
                                {{if .IsUpgrade}}<span class="fa-upgrade-icon">⬆</span> {{end}}{{.Name | safe}}
                                {{if .IsUpgrade}}
                                    <div style="font-size:0.85em;color:#3ae87a;margin-top:2px;">Upgrade for {{.UpgradeType}}: {{.UpgradeFor}}</div>
                                {{end}}
                            </td>
                            <td>{{.DynastyValue}}</td>
                        </tr>
                    {{end}}
                    </tbody>
                </table>
            </div>
            {{end}}

            <br>
        </div>
    {{end}}
</div>

<div class="legend" style="margin-top:32px; margin-bottom:24px; font-size:0.9em; color:#c5d5f0; display:flex; flex-wrap:wrap; gap:20px; align-items:center; justify-content:center; padding:16px; background:rgba(30,38,54,0.4); border-radius:12px; backdrop-filter:blur(10px); border:1px solid rgba(123,176,255,0.1);">
    <span style="font-weight:600; margin-right:8px; color:#7bb0ff; text-transform:uppercase; letter-spacing:0.5px; font-size:0.85em;">Legend:</span>
    <span style="display:inline-flex; align-items:center; gap:6px;"><span class="tier1-star">★</span> <span style="font-weight:500;">Tier 1</span></span>
    <span style="display:inline-flex; align-items:center; gap:6px;"><span style="background:#7bb0ff;color:#1a1f2e;padding:3px 7px;border-radius:6px;font-size:0.8em;font-weight:bold;">FLEX</span> <span style="font-weight:500;">FLEX tier</span></span>
    <span style="display:inline-flex; align-items:center; gap:6px;"><span class="swap-icon">⇄</span> <span style="font-weight:500;">Swap</span></span>
    <span style="display:inline-flex; align-items:center; gap:6px;"><span style="background:#3a1e1e; color:#ffb6b6; padding:3px 8px; border-radius:6px; font-weight:500;">Red</span> <span style="font-weight:500;">Suboptimal</span></span>
</div>

</div>
<script>
if (document.getElementById('defaultTab')) document.getElementById('defaultTab').click();
</script>
<script src="/static/sortable.js"></script>

<footer style="margin-top:3em; padding:2.5em 1.5em; text-align:center; border-top:1px solid rgba(123,176,255,0.15); background:rgba(30,38,54,0.3); backdrop-filter:blur(10px);">
    <div style="margin-bottom:1.4em; font-size:0.95em; color:#c5d5f0;">
        <span style="display:inline-block; margin:0.5em 1em;">
            Tiers powered by <a href="https://www.borischen.co/" target="_blank" rel="noopener" style="color:#7bb0ff; text-decoration:none; font-weight:600; transition:color 0.2s;">Boris Chen</a>
        </span>
        {{with .Leagues}}
            {{range .}}
                {{if .IsDynasty}}
                    <span style="display:inline-block; margin:0.5em 1em;">
                        Dynasty values by <a href="https://github.com/dynastyprocess/data" target="_blank" rel="noopener" style="color:#7bb0ff; text-decoration:none; font-weight:600; transition:color 0.2s;">DynastyProcess</a>{{if .DynastyValueDate}} (updated {{.DynastyValueDate}}){{end}}
                    </span>
                    {{break}}
                {{end}}
            {{end}}
        {{end}}
        <span style="display:inline-block; margin:0.5em 1em;">
            <a href="https://github.com/wbollock/sleeperPy" target="_blank" rel="noopener" style="color:#7bb0ff; text-decoration:none; font-weight:600; transition:color 0.2s;">GitHub</a>
        </span>
        <span style="display:inline-block; margin:0.5em 1em;">
            <a href="https://buymeacoffee.com/wbollock" target="_blank" rel="noopener" style="color:#FFDD00; text-decoration:none; font-weight:600; transition:all 0.2s; text-shadow:0 0 8px rgba(255,221,0,0.3);">☕ Buy Me a Coffee</a>
        </span>
    </div>
    <div style="font-size:0.88em; color:#8a9ab8;">
        If you like this project, please <a href="https://github.com/wbollock/sleeperPy" target="_blank" rel="noopener" style="color:#9aa8c0; text-decoration:none; transition:color 0.2s;">drop a ⭐ on GitHub</a>
    </div>
</footer>
{{end}}
<style>
    .app-header {
        width: 100%;
        background: linear-gradient(135deg, rgba(58, 110, 232, 0.15) 0%, rgba(88, 86, 214, 0.15) 100%);
        backdrop-filter: blur(20px);
        padding: 40px 0 24px 0;
        text-align: center;
        margin-bottom: 32px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2);
        border-bottom: 1px solid rgba(123, 176, 255, 0.2);
    }
    .app-header h1 {
        color: #e8eef7;
        font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
        font-size: 2.5em;
        font-weight: 700;
        letter-spacing: -0.5px;
        margin: 0;
        text-shadow: 0 2px 16px rgba(58, 110, 232, 0.3);
    }
    .main-content {
        max-width: 920px;
        margin: 0 auto;
        padding: 32px 24px 24px 24px;
        background: rgba(30, 38, 54, 0.4);
        backdrop-filter: blur(20px);
        border-radius: 16px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(123, 176, 255, 0.1);
    }
.fa-section {
    margin-top: 2em;
    margin-bottom: 1.5em;
}
.fa-header {
    font-size: 1.2em;
    font-weight: 700;
    margin-bottom: 1em;
    color: #7bb0ff;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    text-align: center;
    padding: 12px;
    background: rgba(123, 176, 255, 0.08);
    border-radius: 10px;
    border: 1px solid rgba(123, 176, 255, 0.15);
}
.fa-upgrade {
    background: linear-gradient(90deg, rgba(58, 232, 122, 0.12) 0%, rgba(30, 58, 46, 0.25) 100%) !important;
    border-left: 3px solid #3ae87a;
}
.fa-upgrade-icon {
    color: #3ae87a;
    font-weight: bold;
    font-size: 1.25em;
    margin-right: 6px;
    filter: drop-shadow(0 0 4px rgba(58, 232, 122, 0.4));
}
.mode-toggle-container {
    margin-bottom: 24px;
    text-align: center;
}
.mode-toggle {
    display: inline-flex;
    background: rgba(30, 38, 54, 0.6);
    border-radius: 12px;
    padding: 4px;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(123, 176, 255, 0.2);
}
.mode-btn {
    background: transparent;
    border: none;
    color: #9fb3d4;
    padding: 12px 32px;
    font-size: 0.95em;
    font-weight: 600;
    cursor: pointer;
    border-radius: 8px;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}
.mode-btn:hover {
    color: #c5d5f0;
    background: rgba(123, 176, 255, 0.1);
}
.mode-btn.active {
    background: linear-gradient(135deg, rgba(123, 176, 255, 0.3) 0%, rgba(88, 86, 214, 0.3) 100%);
    color: #e8eef7;
    box-shadow: 0 2px 8px rgba(123, 176, 255, 0.3);
}
.mode-description {
    margin-top: 12px;
    font-size: 0.9em;
    color: #8a9ab8;
    font-style: italic;
}
</style>
</body>
</html>
